<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestión de Usuarios</title>
    <script>
        
        function cargarUsuarios() {
            const xhr = new XMLHttpRequest();
            xhr.open("GET", "usuarios", true); 

            xhr.onload = function() {
                if (xhr.status === 200) {
                    const usuarios = JSON.parse(xhr.responseText);
                    const listaUsuarios = document.getElementById("listaUsuarios");
                    listaUsuarios.innerHTML = ''; 

                    if (usuarios.length === 0) {
                        listaUsuarios.innerHTML = '<li>No hay usuarios disponibles.</li>';
                    } else {
                        usuarios.forEach(usuario => {
                            const li = document.createElement("li");
                            li.textContent = `${usuario.nombre} ${usuario.apellido} - ${usuario.edad} años, ${usuario.nacionalidad}`;

                            
                            const enlaceEliminar = document.createElement("span");
                            enlaceEliminar.textContent = " [Eliminar]";
                            enlaceEliminar.style.color = "red";
                            enlaceEliminar.style.cursor = "pointer";

                            
                            enlaceEliminar.onclick = function() {
                                eliminarUsuario(usuario.id); 
                            };

                            
                            li.appendChild(enlaceEliminar);

                            
                            listaUsuarios.appendChild(li);
                        });
                    }
                } else {
                    alert("Error al cargar los usuarios");
                }
            };

            xhr.onerror = function() {
                alert("Error en la conexión");
            };

            xhr.send();
        }

        
        function eliminarUsuario(id) {
            const xhr = new XMLHttpRequest();
            xhr.open("DELETE", "usuarios/" + id, true); 

            xhr.onload = function() {
                if (xhr.status === 200) {
                    alert("Usuario eliminado con éxito");
                    cargarUsuarios(); 
                } else {
                    alert("Error al eliminar el usuario");
                }
            };

            xhr.onerror = function() {
                alert("Error en la conexión");
            };

            xhr.send();
        }

        
        function crearUsuario() {
            const nombre = document.getElementById("nombre").value;
            const apellido = document.getElementById("apellido").value;
            const edad = document.getElementById("edad").value;
            const nacionalidad = document.getElementById("nacionalidad").value;

            const usuario = {
                nombre: nombre,
                apellido: apellido,
                edad: parseInt(edad),
                nacionalidad: nacionalidad
            };

            const xhr = new XMLHttpRequest();
            xhr.open("POST", "usuarios", true); 
            xhr.setRequestHeader("Content-Type", "application/json");

            xhr.onload = function() {
                if (xhr.status === 201) {
                    alert("Usuario creado con éxito");
                    
                    // Limpiar el formulario
                    document.getElementById("nombre").value = '';
                    document.getElementById("apellido").value = '';
                    document.getElementById("edad").value = '';
                    document.getElementById("nacionalidad").value = '';
                    
                    cargarUsuarios(); 
                } else {
                    alert("Error al crear el usuario");
                }
            };

            xhr.send(JSON.stringify(usuario)); 
        }
    </script>
</head>
<body>
    <h1>Gestión de Usuarios</h1>

    <h2>Crear Usuario</h2>
    <form onsubmit="event.preventDefault(); crearUsuario();">
        <label for="nombre">Nombre:</label>
        <input type="text" id="nombre" required><br><br>

        <label for="apellido">Apellido:</label>
        <input type="text" id="apellido" required><br><br>

        <label for="edad">Edad:</label>
        <input type="number" id="edad" required><br><br>

        <label for="nacionalidad">Nacionalidad:</label>
        <input type="text" id="nacionalidad" required><br><br>

        <button type="submit">Crear Usuario</button>
    </form>

    <h2>Lista de Usuarios</h2>
    <button onclick="cargarUsuarios()">Cargar Usuarios</button>
    <ul id="listaUsuarios">
        
    </ul>
</body>
</html>
